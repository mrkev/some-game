var at=Object.defineProperty;var ht=(r,t,e)=>t in r?at(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var d=(r,t,e)=>(ht(r,typeof t!="symbol"?t+"":t,e),e);import{j as T,r as A,m as y,c as lt,R as dt}from"./vendor.5f2e558a.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=e(o);fetch(o.href,a)}})();const g=16,k=10,v=10,K=4,ut=T.exports.Fragment,M=T.exports.jsx,ft=T.exports.jsxs,L=new WeakSet,j=new WeakSet;function pt({tileAt:r,entities:t,onClick:e}){const s=A.exports.useRef(null),o=At(t,r,s,e);return mt(s,r,t),M("canvas",{style:{background:"gray"},width:g*10,height:g*10,ref:s,onClick:o})}function At(r,t,e,s){return A.exports.useCallback(o=>{const a=e.current.getBoundingClientRect(),l=(o.clientX-a.left)/K,p=(o.clientY-a.top)/K,f=W(l,p,r),h=p/g>>0,c=l/g>>0,i=t(c,h);s==null||s(f,i)},[e,r,s,t])}function mt(r,t,e){const[s]=A.exports.useState(()=>y.exports.Engine.create({gravity:{x:0,y:0}}));A.exports.useEffect(()=>{const o=r.current,a=o==null?void 0:o.getContext("2d");if(o==null||a==null)return;a.imageSmoothingEnabled=!1;let l=0,p=-1;return l=requestAnimationFrame(function h(c){const i=c/200>>0;for(let u=0;u<k;u++)for(let m=0;m<v;m++){const w=t(u,m);j.has(w)||(j.add(w),w.mBody!=null&&y.exports.Composite.add(s.world,w.mBody))}for(const u of e)L.has(u)||(L.add(u),u.mBody!=null&&y.exports.Composite.add(s.world,u.mBody)),u.update();const S=p>0?c-p:1e3/60;y.exports.Engine.update(s,S);for(const u of e)u.mBody&&(u.x=Math.round(u.mBody.position.x),u.y=Math.round(u.mBody.position.y),y.exports.Body.setPosition(u.mBody,{x:u.x,y:u.y}));for(let u=0;u<k;u++)for(let m=0;m<v;m++){const w=t(u,m);for(const E of w.bSprites)E.render(a,u*g,m*g,i)}for(const u of e)u.update(),u.render(a,i);for(let u=0;u<k;u++)for(let m=0;m<v;m++){const w=t(u,m);for(const E of w.fSprites)E.render(a,u*g,m*g,i)}p=c,l=requestAnimationFrame(h)}),()=>{cancelAnimationFrame(l)}},[r,e,s,t])}function W(r,t,e){const s=[];for(const o of e){const{x:a,y:l,width:p,height:f}=o;r>a&&r<a+p&&t>l&&t<l+f&&s.push(o)}return s}function wt(r,t){return r._subscriptors.add(t),()=>r._subscriptors.delete(t)}function D(r,t,e="immediate"){switch(e){case"immediate":r._subscriptors.forEach(s=>{s(t)});break;case"task":window.setTimeout(()=>{r._subscriptors.forEach(s=>{s(t)})},0);break;case"microtask":gt(Promise.resolve().then(()=>{r._subscriptors.forEach(s=>{s(t)})}));break;default:G(e)}}function G(r){throw new Error(`Exhaustive violation, unexpected value ${r}`)}function gt(r){r.catch(t=>{throw t})}class X{constructor(t,e,s,o,a){d(this,"x");d(this,"y");d(this,"width");d(this,"height");d(this,"collisionMode");d(this,"mBody");d(this,"highlight",!1);switch(this.x=t,this.y=e,this.width=s,this.height=o,this.collisionMode=a,this.collisionMode){case"collides":this.mBody=y.exports.Bodies.rectangle(t,e,s,o,{restitution:0,friction:0,frictionAir:.2});break;case"static":this.mBody=y.exports.Bodies.rectangle(t,e,s,o,{isStatic:!0});break;case"none":this.mBody=null;break;default:G(this.collisionMode)}}}function P(r){throw new Error(`unexpected ${r} in switch statement`)}class N extends X{constructor(e,s,o,a="collides"){const l=o.down.tileMap.tileSize,p=o.down.tileMap.tileSize;super(e,s,l,p,a);d(this,"vx",0);d(this,"vy",0);d(this,"sprites");d(this,"facing",2);this.sprites=o}update(){this.mBody?y.exports.Body.setVelocity(this.mBody,{x:this.vx,y:this.vy}):(this.x+=this.vx,this.y+=this.vy),this.vy>0?this.facing=2:this.vy<0?this.facing=0:this.vx>0?this.facing=1:this.vx<0&&(this.facing=3)}render(e,s){switch(e.fillStyle="red",this.highlight&&(e.fillStyle="#65FF00",console.log("here"),e.fillRect(this.x,this.y,this.width,this.height)),this.facing){case 0:{this.vy===0?this.sprites.up.render(e,this.x,this.y,s):this.sprites.walkUp.render(e,this.x,this.y,s);break}case 1:{this.vx===0?this.sprites.right.render(e,this.x,this.y,s):this.sprites.walkRight.render(e,this.x,this.y,s);break}case 2:{this.vy===0?this.sprites.down.render(e,this.x,this.y,s):this.sprites.walkDown.render(e,this.x,this.y,s);break}case 3:{this.vx===0?this.sprites.left.render(e,this.x,this.y,s):this.sprites.walkLeft.render(e,this.x,this.y,s);break}default:P(this.facing)}}destroy(){}}function yt(r,t){let s,o;switch(r.facing){case 0:{s=r.x+r.width/2,o=r.y-4;break}case 1:{s=r.x+r.width+4,o=r.y+r.height/2;break}case 2:{s=r.x+r.width/2,o=r.y+r.height+4;break}case 3:{s=r.x-4,o=r.y+r.height/2;break}default:P(r.facing)}const l=W(s,o,t.entities._getRaw()).at(-1);return l!=null?l:null}class B extends X{constructor(e,s,o,a,l){super(s,o,e.width,e.height,a);d(this,"sprite");d(this,"description");this.sprite=e,this.description=l}destroy(){}update(){}render(e,s){this.sprite.render(e,this.x,this.y,s)}}const Mt=""+new URL("Characters_V3T.5255357c.png",import.meta.url).href,xt="data:image/png;base64,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";class x{constructor(t,e,s,o,a="none",l=1){d(this,"tileMap");d(this,"tilePositions");d(this,"cWidth");d(this,"rHeight");d(this,"flip");d(this,"animSpeed");d(this,"width");d(this,"height");this.tileMap=t,this.tilePositions=e,this.cWidth=s,this.rHeight=o,this.flip=a,this.animSpeed=l,this.width=this.tileMap.tileSize*s,this.height=this.tileMap.tileSize*o}withFlip(t){return new x(this.tileMap,this.tilePositions,this.cWidth,this.rHeight,t,this.animSpeed)}render(t,e,s,o){const a=this.tilePositions[Math.floor(o/this.animSpeed)%this.tilePositions.length],l=Math.floor(a/this.tileMap.cols),p=a-l*this.tileMap.cols,f=this.tileMap.tileSize,h=this.flip==="horizontal"||this.flip==="both",c=this.flip==="vertical"||this.flip==="both";t.save(),t.setTransform(h?-1:1,0,0,c?-1:1,e+(h?this.tileMap.tileSize:0),s+(c?this.tileMap.tileSize:0)),t.drawImage(this.tileMap.image,p*f,l*f,this.cWidth*f,this.rHeight*f,0,0,this.cWidth*f,this.rHeight*f),t.restore()}}class H{constructor(t,e){d(this,"image");d(this,"tileSize");d(this,"cols");d(this,"rows");this.image=t,this.tileSize=e,this.cols=this.image.width/e>>0,this.rows=this.image.height/e>>0}spriteAt(t,e,s=1,o=1){const a=t*this.cols+e;return new x(this,[a],s,o)}spriteNumber(t,e=1,s=1){return new x(this,[t],e,s)}sprites(...t){return t.map(e=>new x(this,[e],1,1))}spriteAnimating(t,e){return new x(this,t,1,1,"none",e)}spritesAnimating(t,e){return new x(this,t,1,1,"none",e)}coordsOfPosition(t){const e=Math.floor(t/this.cols);return[(t-e*this.cols)*this.tileSize,e*this.tileSize]}}class U{static loadImage(t){return new Promise(e=>{const s=new Image;s.src=t,s.onload=function(){e(s)}})}}class Et{constructor(t,e,s,o,a){d(this,"fSprites");d(this,"bSprites");d(this,"collides");d(this,"row");d(this,"col");d(this,"mBody");this.fSprites=t,this.bSprites=e,this.collides=s,this.row=o,this.col=a,this.collides?this.mBody=y.exports.Bodies.rectangle(a*16,o*16,16,16,{isStatic:!0,restitution:0,friction:0}):this.mBody=null}}class Ct{constructor(t){d(this,"_array");d(this,"_subscriptors",new Set);this._array=t}_getRaw(){return this._array}_setRaw(t){this._array=t,D(this,this._array)}static create(t){return new this(t!=null?t:[])}mutate(t){console.log("mutateeeee");const e=[...this._array],s=t(e);return this._array=e,D(this,this._array),s}get length(){return this._array.length}at(t){throw new Error("Method not implemented.")}[Symbol.iterator](){return this._array[Symbol.iterator]()}toString(){return`${this.constructor.name}[${this._array.toString()}]`}toLocaleString(){throw this._array.toLocaleString()}pop(){if(!(this.length<1))return this.mutate(t=>t.pop())}shift(){if(!(this.length<1))return this.mutate(t=>t.shift())}push(...t){return t.length<1?this.length:this.mutate(e=>e.push(...t))}unshift(...t){return t.length<1?this.length:this.mutate(e=>e.unshift(...t))}sort(t){return this.mutate(e=>(e.sort(t),this))}reverse(){return this.mutate(t=>(t.reverse(),this))}splice(t,e,...s){return this.mutate(o=>o.splice(t,e,...s))}fill(t,e,s){return this.mutate(o=>(o.fill(t,e,s),this))}copyWithin(t,e,s){return this.mutate(o=>(o.copyWithin(t,e,s),this))}map(t,e){return this._array.map(t,e)}indexOf(t,e){return this._array.indexOf(t,e)}remove(t){const e=this.indexOf(t);return e===-1?null:this.splice(e,1)[0]}[Symbol.unscopables](){return this._array[Symbol.unscopables]}slice(t,e){throw new Error("Method not implemented.")}concat(...t){throw new Error("Method not implemented.")}join(t){throw new Error("Method not implemented.")}lastIndexOf(t,e){throw new Error("Method not implemented.")}every(t,e){throw new Error("Method not implemented.")}some(t,e){throw new Error("Method not implemented.")}forEach(t,e){throw new Error("Method not implemented.")}filter(t,e){throw new Error("Method not implemented.")}find(t,e){throw new Error("Method not implemented.")}findIndex(t,e){throw new Error("Method not implemented.")}entries(){throw new Error("Method not implemented.")}keys(){throw new Error("Method not implemented.")}values(){throw new Error("Method not implemented.")}includes(t,e){throw new Error("Method not implemented.")}flatMap(t,e){throw new Error("Method not implemented.")}flat(t){throw new Error("Method not implemented.")}}class R{constructor(t){d(this,"_value");d(this,"_subscriptors",new Set);this._value=t}static of(t){return new this(t)}set(t){performance.mark("0"),this._value=t,D(this,this._value),performance.mark("1"),performance.measure("a","0","1")}setDyn(t){const e=t(this.get());this.set(e)}get(){return this._value}peek(){return this.get()}replace(t){this.set(t)}}function Y(r){const[t,e]=A.exports.useState(()=>r.get());A.exports.useEffect(()=>wt(r,()=>{e(()=>r.get())}),[r]);const s=r.get();A.exports.useEffect(()=>{e(()=>s)},[s]);const o=A.exports.useCallback(a=>{a instanceof Function?r.set(a(r.get())):r.set(a)},[r]);return[t,o]}class Bt{constructor(t){d(this,"_subscriptors",new Set);d(this,"_hash",0);d(this,"schema");this.schema=t}peek(){const t=Object.entries(this.schema).map(([e,s])=>[e,s.peek()]);return Object.fromEntries(t)}child(t){if(!(t in this.schema))throw new Error(`${this.constructor.name}: no key ${String(t)} found. Keys: ${Object.keys(this.schema)}`);return this.schema[t]}browse(t){const e={__path:[]},s=new Proxy(e,{get:(a,l)=>{if(typeof l=="symbol")throw new Error("TODO CANT SYMBOL");return a.__path.push(l),s}});t(s);let o=this;for(const a of e.__path)o=o.child(a);return o}replace(t){throw new Error("not implemented")}}function J(r){return new R(r)}function C(r){return new Bt(r)}const V=C({zoo:C({animals:C({lions:J(3)})}),park:C({animals:C({lions:J(3)})})});V.browse(r=>r.park.animals.lions);window.a=V;class St{constructor(t,e){d(this,"interactionMode");d(this,"entities");d(this,"message");this.interactionMode=R.of(t),this.entities=Ct.create(e),this.message=R.of("[wasd] move | [Space] interact")}}function bt(r,t){const e=[];for(let s=0;s<r.length;s++){const o=[];e.push(o);for(let a=0;a<r.length;a++){const[l,p]=r[s][a],[f,h]=t[s][a];o.push(new Et(f?[f]:[],l?[l]:[],p||h,s,a))}}return e}function kt(r){const t=[];for(let e=0;e<r.length;e++)for(let s=0;s<r.length;s++){const o=r[e][s];if(o==null)continue;const[a,l,p]=o;t.push(new B(a,s*g,e*g,p,l))}return t}function vt(){const[r,t]=A.exports.useState(null),[e,s]=A.exports.useState(null),[o,a]=A.exports.useState(null);return A.exports.useEffect(()=>{async function l(){const p=new H(await U.loadImage(Mt),16),f=new H(await U.loadImage(xt),16),h=[f.spriteAt(9,5),!0],c=[f.spriteAt(9,1),!1],i=[null,!1],S=[f.spriteAt(2,7),!1],w=bt([[h,h,h,h,h,h,h,h,h,h],[h,c,c,c,c,c,c,c,c,h],[h,c,c,c,c,c,c,c,c,h],[h,c,c,c,c,c,c,c,c,h],[h,c,c,c,c,c,c,c,c,h],[h,c,c,c,c,c,c,c,c,h],[h,c,c,c,c,c,c,c,c,h],[h,c,c,c,c,c,c,c,c,h],[h,c,c,c,c,c,c,c,c,h],[h,h,h,h,h,h,h,h,h,h]],[[i,i,i,i,i,i,i,i,i,i],[i,i,i,i,i,i,i,i,i,i],[i,i,i,i,i,i,i,i,i,i],[i,i,i,i,i,i,i,i,i,i],[i,i,i,i,i,i,i,i,i,i],[i,S,i,i,i,i,i,i,i,i],[i,i,i,i,i,i,i,i,i,i],[i,i,i,i,i,i,i,i,i,i],[i,i,i,i,i,i,i,i,i,i],[i,i,i,i,i,i,i,i,i,i]]),[E,_,I]=p.sprites(17,18,19),q=I.withFlip("horizontal"),Z=p.spriteAnimating([21,17,22,17]),$=p.spriteAnimating([23,18,24,18]),O=p.spriteAnimating([25,19,26,19]),tt=O.withFlip("horizontal"),F=new N(32,32,{down:E,up:_,right:I,left:q,walkDown:Z,walkUp:$,walkRight:O,walkLeft:tt});new B(f.spriteAt(3,1),64,32,"static","Full of odd trinkets."),new B(f.spriteAt(3,2,1,2),64,64,"static","It's a fridge. Brr.");const et=[f.spriteAt(2,0),"Something's playing","static"],b=[f.spriteAt(3,1),"Full of food and pans","static"],st=[f.spriteAt(3,0),"Nothing to cook","static"],it=[f.spriteAt(2,4),"What to wear?","static"],rt=[f.spriteAt(2,5),"Lots of clothes","static"],Q=[f.spriteAt(2,6),"Pretty!","static"],nt=[f.spriteAt(1,0),"It's a house","static"],n=null,z=kt([[n,n,nt,n,n,n,n,n,n,n],[n,n,n,n,n,b,b,b,st,n],[n,n,n,n,n,n,n,n,n,n],[n,n,n,n,n,n,n,n,n,n],[n,n,n,n,n,n,n,n,n,n],[n,n,n,n,n,n,et,n,n,n],[n,rt,it,n,n,n,n,n,n,n],[n,n,n,n,n,n,n,n,n,n],[n,n,n,Q,n,n,Q,n,n,n],[n,n,n,n,n,n,n,n,n,n]]);z.push(F),t({envTileMap:f,charTileMap:p});const ot={kind:"controlling",character:F},ct=new St(ot,z);s(ct),a(w)}l()},[]),e==null||r==null||o==null?M(ut,{children:"loading..."}):M(Tt,{gameState:e,assets:r,tileMap:o})}function Dt(r){A.exports.useEffect(()=>{const t=s=>{if(s.repeat)return;const o=r.interactionMode.peek();switch(s.key){case"Escape":o.kind==="controlling"&&(o.character.highlight=!0,r.interactionMode.set({kind:"editing"}))}if(o.kind==="controlling"){const a=o.character;switch(s.key){case"w":a.vy-=1;break;case"a":a.vx-=1;break;case"s":a.vy+=1;break;case"d":a.vx+=1;break;case" ":{const l=yt(a,r);if(l==null){r.message.set("nothing to interact");break}l instanceof B&&r.message.set(l.description);break}}}},e=s=>{if(s.repeat)return;const o=r.interactionMode.peek();if(o.kind==="controlling"){const a=o.character;switch(s.key){case"w":a.vy+=1;break;case"a":a.vx+=1;break;case"s":a.vy-=1;break;case"d":a.vx-=1;break}}};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}},[r,r.interactionMode])}function Rt(){return M("div",{className:"App",children:M(vt,{})})}function Tt({tileMap:r,gameState:t}){Dt(t);const[e]=Y(t.message),[s,o]=Y(t.interactionMode),a=A.exports.useCallback((p,f)=>{for(let h=p.length-1;h>=0;h--){const c=p[h];if(c instanceof N&&s.kind==="editing"){c.highlight=!1,o({kind:"controlling",character:c});return}}},[s.kind,o]),l=A.exports.useCallback((p,f)=>r[f][p],[r]);return ft("div",{style:{display:"flex",flexDirection:"column"},children:[s.kind,M(pt,{tileAt:l,entities:t.entities._getRaw(),onClick:a}),e]})}lt.createRoot(document.getElementById("root")).render(M(dt.StrictMode,{children:M(Rt,{})}));
